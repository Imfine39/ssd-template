# Judgment Criteria Guide

ワークフロー内の曖昧表現に対する具体的な判断基準。

---

## Purpose

「適切に」「妥当か」等の曖昧表現を、具体的なチェックリストや数値基準で判断可能にする。

---

## 曖昧表現カテゴリ

| カテゴリ | 代表的な表現 | 判断基準セクション |
|---------|-------------|------------------|
| 品質判断 | 「適切か」「妥当か」 | [品質判断基準](#品質判断基準) |
| スコープ判断 | 「スコープが適切か」 | [スコープ判断基準](#スコープ判断基準) |
| 粒度判断 | 「粒度が適切か」「Work Breakdown が適切か」 | [粒度判断基準](#粒度判断基準) |
| リスク判断 | 「許容範囲か」「リスクが妥当か」 | [リスク判断基準](#リスク判断基準) |
| 技術判断 | 「技術的に妥当か」「定義が適切か」 | [技術判断基準](#技術判断基準) |
| 条件判断 | 「必要に応じて」「状況に応じて」 | [条件判断基準](#条件判断基準) |

---

## 品質判断基準

### 「内容が要件を正確に反映しているか」

**判断基準チェックリスト:**

| # | チェック項目 | Pass 条件 |
|---|------------|----------|
| 1 | 入力ファイルの全項目が Spec に記載 | 全項目が対応するセクションに存在 |
| 2 | 用語が入力と一致 | ユーザーの表現をそのまま使用 |
| 3 | 数値/制約が正確 | 入力の数値がそのまま反映 |
| 4 | スコープ境界が明確 | In Scope / Out of Scope が入力と一致 |

**NG例:**
- 入力に「3日以内に返信」→ Spec で「数日以内」
- 入力に「認証機能」→ Spec で「セキュリティ機能」

### 「Target Users が適切に定義されているか」

**判断基準:**

| 観点 | 適切 | 不適切 |
|------|------|--------|
| 具体性 | 「20-30代の一人暮らし会社員」 | 「ユーザー」 |
| ペルソナ | 名前・背景・目的がある | 抽象的なカテゴリのみ |
| 数 | 2-5人程度 | 0人または10人以上 |

---

## スコープ判断基準

### 「スコープが適切か（過大/過小でないか）」

**判断基準表:**

| 状態 | 判断指標 | アクション |
|------|---------|-----------|
| **過大** | Feature 数 > 10 / PR が 15+ に分割される見込み | 分割を提案 |
| **適切** | Feature 数 3-10 / 複数 PR に分割可能 | 続行 |
| **過小** | Feature 数 < 3 / 単一 PR で完結 | 統合を検討 |

**追加チェック:**

| チェック項目 | Pass 条件 |
|-------------|----------|
| Out of Scope に除外理由がある | 各項目に理由が記載 |
| In Scope に依存関係がある | 依存が明記または「なし」と記載 |
| MVP が定義されている | 最小限の機能セットが特定可能 |

---

## 粒度判断基準

### 「Work Breakdown が適切な粒度か」

**タスク粒度の基準:**

| 粒度 | 判断指標 | 判断 |
|------|---------|------|
| 細かすぎ | インポート文追加のみ、単なるファイル作成のみ | NG: 統合する |
| 適切 | 1-3ファイルの変更、1つの明確な目的 | OK |
| 粗すぎ | 5ファイル以上の変更、複合目的 | NG: 分割する |

**タスク記述の基準:**

| 観点 | 適切 | 不適切 |
|------|------|--------|
| 動詞 | 「作成する」「実装する」「追加する」 | 「検討する」「考える」 |
| 対象 | 具体的なファイル/コンポーネント | 「関連するもの」「必要なもの」 |
| 完了条件 | 明示的 | 曖昧 |

**例:**

```
# 適切
- [ ] src/components/LoginForm.tsx を作成する
- [ ] useAuth フックに logout 関数を追加する

# 不適切
- [ ] ログイン周りを整理する
- [ ] 必要に応じて修正する
```

### 「Feature Hints の粒度が適切か（1PR 規模）」

**1PR 規模の基準:**

| 指標 | 適切な範囲 |
|------|----------|
| 変更ファイル数 | 1-15 ファイル |
| 追加/変更行数 | 50-500 行 |
| レビュー可能性 | レビュワーが一度に把握可能な規模 |

---

## リスク判断基準

### 「リスクが許容範囲か」

**リスク評価マトリックス:**

| 発生確率 \ 影響度 | 低 | 中 | 高 |
|-----------------|---|---|---|
| **高** | 中 | 高 | 極高 |
| **中** | 低 | 中 | 高 |
| **低** | 低 | 低 | 中 |

**許容判断:**

| リスクレベル | 判断 | アクション |
|------------|------|-----------|
| 極高 | NG | リスク軽減策が必須 |
| 高 | 要確認 | [HUMAN_CHECKPOINT] で判断 |
| 中 | 条件付き許容 | Risks セクションに記載して続行 |
| 低 | 許容 | 続行 |

**リスク記載の基準:**

```markdown
# 適切なリスク記載
- リスク: DBマイグレーション失敗の可能性
- 発生確率: 低（テスト環境で検証済み）
- 影響度: 中（ロールバック手順あり）
- 軽減策: ステージング環境で事前検証

# 不適切なリスク記載
- リスクがあるかもしれない
```

### 「リスクと制約が適切に考慮されているか」

**判断チェックリスト:**

| # | チェック項目 | Pass 条件 |
|---|------------|----------|
| 1 | リスク特定 | 技術・ビジネス・運用の各観点で検討 |
| 2 | 影響度評価 | 高/中/低の評価と根拠あり |
| 3 | 軽減策 | 高・中リスクには軽減策が定義 |
| 4 | 制約の明示 | 技術・時間・コストの制約が明記 |
| 5 | 前提条件 | 依存する前提が明記 |

**制約の種類:**

| 種類 | 例 |
|------|-----|
| 技術制約 | 既存 DB を変更できない、特定ライブラリ必須 |
| 時間制約 | 期限、リリース日 |
| コスト制約 | 予算、人員 |
| 外部制約 | 外部 API の仕様、規制要件 |

---

## 技術判断基準

### 「技術的アプローチが妥当か」

**判断チェックリスト:**

| # | チェック項目 | Pass 条件 |
|---|------------|----------|
| 1 | 既存パターンとの整合性 | プロジェクトの既存パターンに従っている |
| 2 | 依存関係の妥当性 | 新規依存は最小限、既存依存を活用 |
| 3 | パフォーマンス考慮 | N+1、メモリリーク等の考慮あり |
| 4 | セキュリティ考慮 | 認証/認可/入力検証の考慮あり |
| 5 | テスタビリティ | ユニットテスト可能な設計 |

### 「コミットメッセージが適切か」

**判断チェックリスト:**

| # | チェック項目 | Pass 条件 |
|---|------------|----------|
| 1 | プレフィックス | feat/fix/docs/refactor 等の prefix あり |
| 2 | 要約行 | 50文字以内で変更内容を要約 |
| 3 | 本文（任意） | 「なぜ」変更したかを説明 |
| 4 | Issue 参照 | 関連 Issue への参照あり（`#123`） |
| 5 | 破壊的変更 | BREAKING CHANGE があれば明記 |

**例:**
```
# 適切
feat: ユーザー認証機能を追加 (#123)

ログイン/ログアウト機能を実装。
JWT トークンベースの認証を採用。

# 不適切
fix bug
修正
```

### 「M-*/API-* 定義が適切か」

**Master (M-*) 定義の基準:**

| 観点 | 適切 | 不適切 |
|------|------|--------|
| 単一責任 | 1つの概念に1つのマスター | 複数概念を1つにまとめる |
| 命名 | ドメイン用語を使用 | 技術用語（table, record） |
| 属性 | 必要最小限の属性 | 全属性を網羅しようとする |

**API (API-*) 定義の基準:**

| 観点 | 適切 | 不適切 |
|------|------|--------|
| リソース指向 | 名詞ベース | 動詞ベース（getUser） |
| バージョニング | 考慮されている | 考慮なし |
| エラーレスポンス | 形式が定義 | 未定義 |

---

## Spec セクション判断基準

### 「Spec の適切なセクションに追記したか」

**Spec Type 別の追記先:**

| 情報の種類 | Vision | Domain | Screen | Feature | Fix |
|-----------|--------|--------|--------|---------|-----|
| 技術的制約の発見 | - | Implementation Notes | - | Implementation Notes | Implementation Notes |
| ユーザー確認結果 | Clarifications | Clarifications | Clarifications | Clarifications | Clarifications |
| 仕様変更 | 該当セクション | 該当セクション | 該当セクション | 該当セクション | 該当セクション |
| エッジケース | User Journeys | Business Rules | Screen Details | Use Cases | Reproduction |
| リスク発見 | Risks | Risks | Risks | Risks | Risks |

**追記先の判断フロー:**

```
情報の種類を判定
    │
    ├─ 技術的発見 → Implementation Notes
    ├─ ユーザー確認 → Clarifications（日付・Q&A形式）
    ├─ 仕様変更 → 該当セクションを直接更新
    ├─ 新規リスク → Risks セクション
    └─ 不明 → [NEEDS CLARIFICATION] マーカーを付与
```

---

## 条件判断基準

### 「必要に応じて」の具体化

| 文脈 | 「必要」の条件 |
|------|--------------|
| ログ確認 | エラー発生時、または期待と異なる動作時 |
| 手動確認 | 自動検証で判定不能な場合 |
| 追加テスト | 境界値/エッジケースが未テストの場合 |
| ドキュメント更新 | 公開API/設定が変更された場合 |

### 「状況に応じて」の具体化

| 状況 | 判断基準 | アクション |
|------|---------|-----------|
| 時間制約あり | デッドラインまで24時間以内 | 最小限の対応 |
| 品質優先 | レビュー指摘が2回以上 | 追加テスト/リファクタ |
| 学習コスト高 | 新技術導入 | ドキュメント作成必須 |

---

## 使用方法

### ワークフロー内での参照

```markdown
確認事項:
- [ ] スコープが適切か

> **判断基準:** [judgment-criteria.md](../guides/judgment-criteria.md#スコープ判断基準) 参照
```

### HUMAN_CHECKPOINT での使用

曖昧な確認項目がある場合、このガイドの該当セクションを参照して具体的なチェックを行う：

```markdown
=== [HUMAN_CHECKPOINT] Plan Approval ===

確認事項:
- [ ] Work Breakdown が適切か
  → 各タスク 1-3ファイルの変更、1つの明確な目的か
  → 動詞+具体的対象の形式か
```

---

## Cross-Reference

| Document | 関連内容 |
|----------|---------|
| [terminology.md](../constitution/terminology.md) | 用語定義、粒度ガイドライン |
| [quality-gates.md](../constitution/quality-gates.md) | 品質ゲート定義 |
| [human-checkpoint-patterns.md](human-checkpoint-patterns.md) | CHECKPOINT パターン |
