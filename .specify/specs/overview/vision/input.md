<!-- Preserved Input -->
<!-- Source: vision-input.md -->
<!-- Date: 2025-12-25T03:33:06.395Z -->

# Vision Quick Input（統合版）

新しいプロジェクトの概要を入力してください。
**画面リストまで入力すると、より精度の高い Spec が生成されます。**

---

## Part A: ビジョン（必須）

### A1. 基本情報

- **プロジェクト名**: Quon案件管理システム
- **一言で説明すると**: 受注案件（プロジェクト）とアサインメンバー、売上計上状況を一元管理する営業・案件管理システム

---

### A2. 課題

- **現状の問題**:
  - 経営陣・経営企画が案件ポートフォリオや売上推移を横串で把握できていない
  - セクター長/マネージャーがメンバーのアサイン状況・空き状況を即座に把握できない
  - 受注案件の情報が分散しており、一元的な売上計上管理が困難
- **なぜ解決したいか**:
  - 経営判断のためのKPIモニタリング・予実管理を効率化したい
  - アサイン調整の意思決定を迅速化し、リソース活用を最適化したい
  - 会計伝票の一括作成により経理業務を省力化したい

---

### A3. ユーザー

- **主なユーザー**:
  - 経営陣: 全案件の売上・粗利・将来売上見込みの俯瞰
  - 経営企画室: 予算対実績・KPIモニタリング・レポーティング
  - セクター長/マネージャー: 自セクター案件の受注・アサイン・売上管理
  - PJオーナー: 自案件の情報登録・更新、メンバーアサイン調整
  - 管理部門（経理）: 売上計上・会計伝票照会
  - システム管理者: マスタ管理、権限管理、監査ログ閲覧
- **ユーザーが達成したいこと**:
  - 経営陣/経営企画: 全社・セクター別の売上・受注状況を一目で把握し、経営判断に活用
  - セクター長/マネージャー: メンバーのアサイン状況を月次マトリクスで確認し、最適なアサインを実現
  - PJオーナー: 案件情報を効率的に登録・更新し、売上推移を把握
  - 経理: 月次売上計上を一括で実行し、会計伝票を自動生成

---

### A4. やりたいこと (3-7個)

1. 受注伝票（案件ヘッダ＋メンバー明細）の登録・変更・照会
2. 売上計上（月次で計上候補を抽出し、会計伝票を一括作成）
3. 案件ダッシュボード（受注金額・売上実績・目標値の推移グラフ表示）
4. アサイン状況マトリクス（メンバー×月の予定/確定稼働率を可視化）
5. 参照登録（過去案件や引合から情報を引き継いで新規案件登録）
6. マスタ管理（クライアント/エンドクライアント/メンバー/セクター等）
7. 監査ログ照会（すべての更新操作を記録・検索）

---

### A5. やらないこと (任意)

- 引合管理（別システムで管理する想定）
- 多通貨対応（初期リリースはJPY固定、将来拡張）
- 工数入力・勤怠管理（実績は予定・実績テーブルで管理するが、勤怠システム連携は対象外）
- モバイルアプリ対応（Webブラウザのみ）

---

### A6. 制約・前提条件 (任意)

- **組織構造**:
  - セクター単位で案件・メンバーを管理
  - PJオーナー（案件責任者）は通常セクター長またはマネージャー
  - ロール: 管理者、経営陣、経営企画、セクター長/マネージャー、一般メンバー
- **ビジネスロジック**:
  - 稼働月数 = (終了日 - 開始日 + 1日) / 30（小数第3位で四捨五入）
  - チャージ率 = 実売単価 / 社内標準売価 × 100
  - 会計明細は1受注明細×1計上月あたり2行（Dr/Cr）
- **技術制約**:
  - フロントエンド: Next.js (React + TypeScript)
  - バックエンド: FastAPI (Python)
  - データベース: Azure SQL Database
  - 認証: Azure AD (Entra ID) によるSSO
  - インフラ: Azure App Service
- **その他**:
  - 排他制御: 同一案件の同時編集防止（ロック機構）
  - 応答時間目標: 検索系3秒以内、登録系5秒以内（P95）
  - 監査ログ保持期間: 会計・監査要件に応じて別途定義

---

## Part B: 画面イメージ（任意だが推奨）

> **Note**: 画面リストが明確な場合は記入してください。
> 空欄でも Vision Spec は作成できますが、後の `/spec-mesh design` で再度入力が必要になります。

### B1. 画面リスト

必要な画面を記載してください。
画面名だけでもOK、主な要素や補足があればサブリストで追記してください。

- ログイン／トップ画面 (S-001)
    - Microsoft SSO後のランディング
    - ダッシュボード等への入口
- 案件検索画面 (S-002)
    - 案件No、クライアントなどで案件を検索
    - 検索結果から受注伝票画面へ遷移
- 受注伝票登録・変更・照会画面 (S-003)
    - ヘッダ情報（案件基本情報、PJ状況サマリ、ネクストアクション）
    - 明細タブ（メンバー単位のアサイン情報）
    - 計上状況タブ（メンバー×月の計上金額マトリクス）
    - 簡易ダッシュボード（売上推移グラフ）
    - タブ: Summary / 関連案件 / 案件情報入力 / 注文書(添付) / アクション履歴
    - モード: 照会 / 変更 / 新規登録
- 売上計上画面 (S-004)
    - 計上期間（年月）を指定
    - 計上候補一覧（案件・メンバー・金額）
    - チェックボックスで選択→会計伝票一括作成
- 案件ダッシュボード画面 (S-005)
    - 案件別の受注金額・売上実績・目標値の推移グラフ
    - 縦軸: 金額、横軸: 年月
    - 会計ベース/実績ベースの切替
- アサイン状況マトリクス画面 (S-006)
    - 行: メンバー、列: 月
    - セル: 予定稼働率/確定稼働率
    - 上部: アベイラブル/アサイン予定/アサイン確定の3ブロック表示
    - ホバー時: 案件ごとの稼働率内訳ポップアップ
- マスタ管理画面群 (S-008)
    - クライアント/エンドクライアント/メンバー/セクター等のマスタ編集
- 監査ログ照会画面 (S-009)
    - 操作履歴の検索・照会

---

### B2. 画面遷移（わかっている範囲）

どの画面からどの画面に移動するか記載してください。
わからなければ空欄でOKです。

- ログイン → トップ（ダッシュボード入口）
- トップ → 案件検索画面、案件ダッシュボード、アサイン状況マトリクス、売上計上画面、マスタ管理、監査ログ
- 案件検索画面 → 受注伝票画面（照会モード）
- 受注伝票画面 → 新規登録モード、変更モード
- 受注伝票画面（参照登録） → 新規登録モード（過去案件/引合から情報コピー）

---

## Part C: デザイン希望（任意）

### C1. デザインスタイル

- 企業向け業務システム（シンプル・機能的）
- 社内標準UIライブラリに準拠

### C2. レスポンシブ対応

- [x] PC のみ
- [ ] PC + タブレット
- [ ] PC + タブレット + スマホ（フル対応）

### C3. 参考画像

- なし（既存UI要件に従う）

---

## Part D: ビジネスルール（任意だが推奨）

> **Note**: 業務ルールや計算ロジックが明確な場合は記入してください。
> Domain Spec の Business Rules セクションに反映されます。

### D1. 業務ルール

- 受注伝票は案件ヘッダ（project_orders）とメンバー明細（project_order_items）で構成
- 変更モードでは既存明細の物理削除不可（論理削除のみ）
- 売上計上済みの明細の取り扱いはPhase 2で決定（変更禁止 or 差額調整伝票）
- アサイン状況は終了日と今日の日付で自動更新（終了日 < 今日 → アサイン終了）
- 排他制御: 同一案件を複数ユーザーが同時編集できない（ロック機構）
- 二重計上防止: 同一明細×同一月の会計明細は一度のみ作成可能

### D2. バリデーションルール

- 日付形式: YYYY/MM/DD 以外はエラー
- 契約期間: 契約開始日 <= 契約終了日
- アサイン期間: 開始日 <= 終了日
- 稼働率: 0〜100（小数第2位まで）
- 金額系: 負数禁止、0は許容
- 必須項目が未入力の場合はエラー

### D3. 計算ルール

- 稼働月数 = (終了日 - 開始日 + 1日) / 30（小数第3位で四捨五入）
- 単月小計 = 単価 × (稼働率/100) × 数量 - 値引額
- 概算売上 = 単月小計 × 稼働月数
- 正味額 = 明細の概算売上合計 - 値引き等
- 単月平均 = 正味額 / 契約月数
- チャージ率(%) = 実売単価 / 社内標準売価 × 100
- 計上済売上 = accounting_entries から当該受注明細の累計計上額を集計

---

## 入力完了後

1. このファイルを保存
2. `/spec-mesh vision` を実行
3. AI が Vision Spec を生成し、画面情報があれば `/spec-mesh design` で活用されます
