---
description: Verify integrity and create PR (Step 5). Final step before human review.
---

## Purpose

Step 5 of the 6-step workflow. Before creating a PR, this command:
1. Verifies spec-implementation integrity
2. Runs final checks (lint, tests)
3. Records any remaining feedback
4. Creates the PR with proper references

## Steps

1) **Integrity check - Spec vs Implementation**:

   a) **Load context**:
      - Read spec from feature directory
      - Parse all UC/FR/SC IDs
      - List all implementation files changed (via git diff)

   b) **Verify coverage**:
      - For each UC: Is there at least one test?
      - For each FR: Is the requirement implemented?
      - Check test files for spec annotations (@spec, @uc, @fr)

   c) **Check for drift**:
      - Compare Implementation Notes in spec with actual implementation
      - Any undocumented deviations?
      - Any constraints discovered but not recorded?

   d) **Report findings**:
      ```
      Integrity Check Results:
      - UCs covered: 3/3
      - FRs implemented: 5/5
      - Tests with spec annotations: 8
      - Undocumented items: [list if any]
      ```

2) **Final feedback opportunity**:
   - If undocumented items found, ask human:
     ```
     Found undocumented items. Record as feedback?
     - [item 1]
     - [item 2]
     [Yes/No]
     ```
   - If yes, run `/speckit.feedback` for each item

3) **Run quality checks**:
   - spec-lint: `node .specify/scripts/spec-lint.js`
   - Project lint (if configured): `npm run lint` or equivalent
   - Tests: `npm test` or configured test command
   - Build (if applicable): `npm run build`

   If any check fails:
   - Report the failure
   - Suggest fix or ask human how to proceed
   - Do NOT create PR with failing checks

4) **Generate PR content**:

   a) **Title** (auto-generated):
      - Feature: `feat: [spec title]`
      - Fix: `fix: [issue title]`

   b) **Body** (auto-generated):
      ```markdown
      ## Summary
      [Brief description from spec Purpose section]

      Fixes #[Issue]
      Implements [Spec IDs]

      ## Changes
      - [List of main changes]

      ## Test Plan
      - [x] Unit tests: [count] added/modified
      - [x] spec-lint: passed
      - [x] Build: passed

      ## Spec Compliance
      - UCs covered: [X/Y]
      - FRs implemented: [X/Y]

      ---
      [Auto-generated by /speckit.pr]
      ```

5) **Create PR**:
   - Run: `node .specify/scripts/pr.js --title "..." --body-file pr-body.md`
   - Display PR URL

6) **Update branch state**:
   ```bash
   node .specify/scripts/state.js branch --set-step pr
   ```

7) **Post-PR guidance**:
   ```
   PR created: [URL]

   Next steps:
   1. Review Codex/bot comments when they arrive
   2. Address any feedback (I can help with "fix PR feedback")
   3. Request human review
   4. Merge when approved
   ```

## Usage

Simply run `/speckit.pr` after completing implementation.
AI will auto-detect context from current branch and spec.

## Manual Override

If you need to customize:
```bash
node .specify/scripts/pr.js --title "custom title" --body "custom body" --test "npm test"
```

## Human Checkpoint

Human reviews and merges the PR. AI can assist with PR feedback fixes.
