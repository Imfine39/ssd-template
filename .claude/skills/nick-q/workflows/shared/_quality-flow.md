# ğŸ˜¼ Quality Flowï¼ˆå“è³ªãƒ•ãƒ­ãƒ¼ï¼‰å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

> **æ¦‚å¿µå®šç¾©:** [quality-gates.md](../../constitution/quality-gates.md) å‚ç…§
> - Multi-Review 3è¦³ç‚¹: [#multi-review](../../constitution/quality-gates.md#multi-review)
> - SPEC GATE: [#spec-gate](../../constitution/quality-gates.md#spec-gate)
>
> ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Quality Flow ã®**é‹ç”¨æ‰‹é †**ã‚’å®šç¾©ã—ã¾ã™ã€‚

QA åˆ†æ â†’ Multi-Review â†’ Lint â†’ SPEC GATE ã®ä¸€é€£ã®ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã€‚
Spec ä½œæˆå¾Œã®å“è³ªæ‹…ä¿ãƒ—ãƒ­ã‚»ã‚¹ã€‚

---

## Purpose

1. **Spec ä½œæˆå¾Œã®å“è³ªæ‹…ä¿ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¨™æº–åŒ–**
2. **å„ã‚¹ãƒ†ãƒƒãƒ—ã®å®Ÿè¡Œé †åºã‚’ä¿è¨¼**
3. **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–“ã®é‡è¤‡ã‚’å‰Šæ¸›**

---

## Quality Flow æ¦‚è¦

```
Spec ä½œæˆå®Œäº†
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜… Quality Flow é–‹å§‹ â˜…               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. QA å›ç­”åˆ†æï¼ˆæœªå›ç­”ç¢ºèªï¼‰          â”‚
â”‚    â†“                                â”‚
â”‚ 2. Multi-Reviewï¼ˆ3è¦³ç‚¹ä¸¦åˆ—ï¼‰         â”‚
â”‚    â†“                                â”‚
â”‚ 3. AI ä¿®æ­£                          â”‚
â”‚    â†“                                â”‚
â”‚ 4. Lint                             â”‚
â”‚    â†“                                â”‚
â”‚ 5. SPEC GATE                        â”‚
â”‚    â†“                                â”‚
â”‚ [BLOCKED â†’ clarify â†’ 2ã¸æˆ»ã‚‹]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ PASSED
å‘¼ã³å‡ºã—å…ƒã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸ï¼ˆCascade Updateï¼‰
```

---

## å‘¼ã³å‡ºã—å…ƒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | å¯¾è±¡ Spec | Quality Flow å¾Œã®é·ç§» |
|-------------|----------|---------------------|
| project-setup.md | Vision + Screen + Domain Spec | issue ã‚¿ã‚¤ãƒ—ã¸èª˜å° |
| feature.md | Feature Spec | plan |
| fix.md | Fix Spec | plan or implement |
| change.md | Vision/Screen/Domain å¤‰æ›´ | plan |

---

## Steps

### Step 1: QA å›ç­”åˆ†æ

**â˜… å¿…é ˆã‚¹ãƒ†ãƒƒãƒ— â˜…**

> **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‚ç…§:** [_qa-followup.md](_qa-followup.md)

```markdown
QA ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å›ç­”çŠ¶æ³ã‚’ç¢ºèª:

1. å›ç­”çŠ¶æ³ãƒã‚§ãƒƒã‚¯
   - [å¿…é ˆ] é …ç›®: å…¨ã¦å›ç­”æ¸ˆã¿ã‹
   - [ç¢ºèª] é …ç›®: æ‰¿èª/å´ä¸‹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹
   - [ææ¡ˆ] é …ç›®: æ¡å¦ãŒæ±ºå®šã—ã¦ã„ã‚‹ã‹
   - [é¸æŠ] é …ç›®: é¸æŠãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹

2. æœªå›ç­”é …ç›®ãŒã‚ã‚‹å ´åˆ
   â†’ AskUserQuestion ã§ç¢ºèªï¼ˆæœ€å¤§4å•ãšã¤ï¼‰

3. çµ‚äº†æ¡ä»¶
   - å…¨ã¦ã® [å¿…é ˆ] ã«å›ç­”ã‚ã‚Š
   - Critical ãªæ›–æ˜§ç‚¹ãŒãªã„
```

#### Post-QA Verificationï¼ˆFeature/Fix ã®ã¿ï¼‰

QA åˆ†æå®Œäº†å¾Œã€è¿½åŠ ã•ã‚ŒãŸè¦ä»¶ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ï¼š

```markdown
QA ã§è¿½åŠ ãƒ»å¤‰æ›´ã•ã‚ŒãŸè¦ä»¶ã‚’ç‰¹å®š:
- æ¡ç”¨ã•ã‚ŒãŸææ¡ˆã‚’ç¢ºèª
- æ–°ãŸã«è¿½åŠ ã•ã‚ŒãŸè¦ä»¶ã‚’ç¢ºèª
- ãã‚Œã‚‰ãŒå‚ç…§ã™ã‚‹ M-*/API-*/SCR-* ã‚’æŠ½å‡º

ä¸è¶³è¦ç´ ã®å¯¾å¿œ:
| çŠ¶æ³ | å¯¾å¿œ |
|------|------|
| å…¨è¦ç´ ãŒå­˜åœ¨ | ãã®ã¾ã¾ç¶šè¡Œ |
| æ–°è¦è¦ç´ ãŒå¿…è¦ | Spec ã«ä»®å®šç¾©ã‚’è¿½è¨˜ â†’ Cascade Update ã§åæ˜  |
| æ—¢å­˜è¦ç´ ã®å¤‰æ›´ãŒå¿…è¦ | change ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å…ˆè¡Œ |
```

### Step 2: Multi-Reviewï¼ˆ3è¦³ç‚¹ä¸¦åˆ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰

> **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‚ç…§:** [review.md](../review.md)

```markdown
1. 3 ã¤ã® reviewer agent ã‚’ä¸¦åˆ—ã§èµ·å‹•:
   - Reviewer A: æ§‹é€ ãƒ»å½¢å¼
   - Reviewer B: å†…å®¹ãƒ»æ•´åˆæ€§
   - Reviewer C: å®Œå…¨æ€§ãƒ»ç¶²ç¾…æ€§

2. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’çµ±åˆ:
   - é‡è¤‡æ’é™¤
   - é‡è¦åº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆCritical â†’ Major â†’ Minorï¼‰

3. çµæœã‚’åˆ†é¡:
   - AI ä¿®æ­£å¯èƒ½: å½¢å¼ã‚¨ãƒ©ãƒ¼ã€ç”¨èªä¸çµ±ä¸€ã€æ˜ã‚‰ã‹ãªæ¬ è½
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªå¿…è¦: æ›–æ˜§ãªè¦ä»¶ã€ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­
```

### Step 3: AI ä¿®æ­£

```markdown
Critical ã¨ Major ã®ã†ã¡ AI ã§ä¿®æ­£å¯èƒ½ãªã‚‚ã®ã‚’ä¿®æ­£:

Edit tool: {spec_path}
  - Fix issue C1: ...
  - Fix issue M1: ...

ä¿®æ­£ãƒ­ã‚°:
=== ä¿®æ­£å®Œäº† ===
- [C1] {issue}: {ä¿®æ­£å†…å®¹}
- [M1] {issue}: {ä¿®æ­£å†…å®¹}
```

### Step 4: Lint å®Ÿè¡Œ

```bash
node .claude/skills/nick-q/scripts/spec-lint.cjs
```

Matrix ãŒå­˜åœ¨ã™ã‚‹å ´åˆ:
```bash
node .claude/skills/nick-q/scripts/matrix-ops.cjs validate
```

### Step 5: SPEC GATE ãƒã‚§ãƒƒã‚¯

**â˜… ã‚¹ã‚­ãƒƒãƒ—ç¦æ­¢ â˜…**

> **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‚ç…§:** [_spec-gate.md](_spec-gate.md)

```markdown
1. [NEEDS CLARIFICATION] ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
2. [DEFERRED] ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
3. Open Questions ã‚’ã‚«ã‚¦ãƒ³ãƒˆï¼ˆOverview Spec ã®ã¿ï¼‰
4. åˆ¤å®š:
   - [NEEDS CLARIFICATION] > 0 â†’ BLOCKED
   - [NEEDS CLARIFICATION] = 0 ã‹ã¤ [DEFERRED] > 0 â†’ PASSED_WITH_DEFERRED
   - [NEEDS CLARIFICATION] = 0 ã‹ã¤ [DEFERRED] = 0 â†’ PASSED

BLOCKED ã®å ´åˆ:
  â†’ clarify ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ
  â†’ clarify å®Œäº†å¾Œã€Step 2 (Multi-Review) ã¸æˆ»ã‚‹

PASSED_WITH_DEFERRED ã®å ´åˆ:
  â†’ [HUMAN_CHECKPOINT] ã§ [DEFERRED] é …ç›®ã‚’æç¤º
  â†’ ãƒªã‚¹ã‚¯ã‚’æ‰¿çŸ¥ã®ä¸Šã§æ‰¿èªã‚’å¾—ã‚‹
  â†’ å‘¼ã³å‡ºã—å…ƒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸

PASSED ã®å ´åˆ:
  â†’ å‘¼ã³å‡ºã—å…ƒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸
```

**Note:** HUMAN_CHECKPOINT ã¯å‘¼ã³å‡ºã—å…ƒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã® Finalize ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿæ–½

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

> **åˆ¤æ–­åŸºæº–:** ã€Œé©åˆ‡ã‹ã€ã€Œå¦¥å½“ã‹ã€ç­‰ã®æ›–æ˜§è¡¨ç¾ã®å…·ä½“çš„åˆ¤æ–­åŸºæº–ã¯ [judgment-criteria.md](../../guides/judgment-criteria.md) ã‚’å‚ç…§

### Vision Spec

| ç¢ºèªé …ç›® | ãƒã‚§ãƒƒã‚¯ |
|---------|---------|
| Vision Spec ã® Purpose ãŒèª²é¡Œ/å•é¡Œã‚’æ­£ç¢ºã«åæ˜ ã—ã¦ã„ã‚‹ã‹ | [ ] |
| Target Users ã¨ User Journeys ãŒé©åˆ‡ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ | [ ] |
| Scope (In/Out) ãŒè¦ä»¶ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ | [ ] |

### Screen + Domain Spec

| ç¢ºèªé …ç›® | ãƒã‚§ãƒƒã‚¯ |
|---------|---------|
| Screen Spec ã®ç”»é¢å®šç¾©ãŒè¦ä»¶ã‚’ç¶²ç¾…ã—ã¦ã„ã‚‹ã‹ | [ ] |
| Domain Spec ã® M-*/API-* å®šç¾©ãŒé©åˆ‡ã‹ | [ ] |
| Cross-Reference Matrix ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ãŸã‹ | [ ] |

### Feature Spec

| ç¢ºèªé …ç›® | ãƒã‚§ãƒƒã‚¯ |
|---------|---------|
| Feature Spec ã® User Stories ãŒæœŸå¾…ã™ã‚‹å‹•ä½œã‚’åæ˜ ã—ã¦ã„ã‚‹ã‹ | [ ] |
| Functional Requirements ãŒé©åˆ‡ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ | [ ] |
| M-*/API-* ã®å‚ç…§/è¿½åŠ ãŒæ­£ã—ã„ã‹ | [ ] |

### Fix Spec

| ç¢ºèªé …ç›® | ãƒã‚§ãƒƒã‚¯ |
|---------|---------|
| Root Cause Analysis ãŒæ­£ç¢ºã‹ | [ ] |
| Proposed Fix ãŒå•é¡Œã‚’è§£æ±ºã™ã‚‹ã‹ | [ ] |
| å½±éŸ¿ç¯„å›²ãŒé©åˆ‡ã«è©•ä¾¡ã•ã‚Œã¦ã„ã‚‹ã‹ | [ ] |
| Verification Plan ãŒååˆ†ã‹ | [ ] |

---

## å‡ºåŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

Quality Flow å®Œäº†æ™‚ã®å‡ºåŠ›ï¼š

```
=== Quality Flow å®Œäº† ===

Spec: {spec_path}

ã€QA åˆ†æã€‘
- [å¿…é ˆ]: {n1}/{N1} å›ç­”æ¸ˆ
- [ç¢ºèª]: {n2}/{N2} å®Œäº†
- [ææ¡ˆ]: {n3}/{N3} æ¡ç”¨
- è¿½åŠ è¦ä»¶: {M} ä»¶

ã€Multi-Reviewã€‘
- Critical: {count} (Fixed: {fixed})
- Major: {count} (Fixed: {fixed})
- Minor: {count}

ã€Lintã€‘
- Status: PASSED

ã€SPEC GATEã€‘
- [NEEDS CLARIFICATION]: {N} ä»¶
- [DEFERRED]: {D} ä»¶
- Open Questions: {M} ä»¶
- Status: {PASSED | PASSED_WITH_DEFERRED | BLOCKED}

{if BLOCKED}
â˜… clarify ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
clarify å®Œäº†å¾Œã€Multi-Review ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã€‚
{/if}

{if PASSED_WITH_DEFERRED}
â˜… [DEFERRED] é …ç›®ãŒã‚ã‚Šã¾ã™:
1. {DEFERREDé …ç›®1}
2. {DEFERREDé …ç›®2}

[HUMAN_CHECKPOINT]
ä¸Šè¨˜ã®ãƒªã‚¹ã‚¯ã‚’æ‰¿çŸ¥ã®ä¸Šã§å…ˆã«é€²ã‚€å ´åˆã¯æ‰¿èªã—ã¦ãã ã•ã„ã€‚
å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã§ [DEFERRED] ã«é­é‡ã—ãŸå ´åˆã€clarify ã«æˆ»ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

â†’ æ‰¿èªå¾Œã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆCascade Updateï¼‰ã¸é€²ã‚€
{/if}

{if PASSED}
â†’ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆCascade Updateï¼‰ã¸é€²ã‚€
{/if}
```

---

## Self-Check

- [ ] QA å›ç­”åˆ†æã‚’å®Œäº†ã—ãŸã‹
- [ ] Multi-Review ã‚’å®Ÿè¡Œã—ãŸã‹ï¼ˆ3è¦³ç‚¹ä¸¦åˆ—ï¼‰
- [ ] AI ä¿®æ­£å¯èƒ½ãªå•é¡Œã‚’ä¿®æ­£ã—ãŸã‹
- [ ] Lint ã‚’å®Ÿè¡Œã—ãŸã‹
- [ ] SPEC GATE ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‹ï¼ˆBLOCKED_CLARIFY â†’ clarify, BLOCKED_OVERVIEW â†’ Overview Changeï¼‰

---

## å‘¼ã³å‡ºã—æ–¹

å„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰ä»¥ä¸‹ã®ã‚ˆã†ã«å‘¼ã³å‡ºã™ï¼š

```markdown
### Step N: Quality Flow

**â˜… å“è³ªæ‹…ä¿ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆå¿…é ˆï¼‰ â˜…**

> **å‚ç…§:** [shared/_quality-flow.md] ã‚’ **Read tool ã§èª­ã¿è¾¼ã‚“ã§** å®Ÿè¡Œ

1. QA å›ç­”åˆ†æ
2. Multi-Reviewï¼ˆ3è¦³ç‚¹ä¸¦åˆ—ï¼‰
3. AI ä¿®æ­£
4. Lint
5. SPEC GATE

BLOCKED_CLARIFY â†’ clarify â†’ Multi-Review ã¸æˆ»ã‚‹
BLOCKED_OVERVIEW â†’ Overview Change â†’ Multi-Review ã¸æˆ»ã‚‹
PASSED â†’ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸
```
