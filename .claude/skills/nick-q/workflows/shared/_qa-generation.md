# QA ドキュメント生成

Pre-Input を分析し、ユーザー向け QA ドキュメントを生成する共通コンポーネント。

## 設計思想

実際の SIer のワークフローを模倣：
1. **ドキュメント交換**: Pre-Input → QA ドキュメント → ユーザー回答
2. **フォローアップ（対話）**: 未回答・派生質問・提案確認を AskUserQuestion で対話

## 使用タイミング

| ワークフロー | トリガー | 出力先 |
|--------------|----------|--------|
| project-setup | Input 読み込み後 | `.specify/specs/overview/qa.md` |
| feature | Input 読み込み後 | `.specify/specs/features/{feature-id}/qa.md` |

> **Note:** fix ワークフローは QA ドキュメントを使用せず、簡易 AskUserQuestion で対応します。

---

## QA ドキュメント構造

### 質問カテゴリ

| マーカー | 意味 | 必須度 | 例 |
|----------|------|--------|-----|
| `[必須]` | 必ず回答が必要 | 高 | 「対象ユーザーは誰ですか？」 |
| `[確認]` | AI の推測を確認 | 中 | 「〇〇と理解しましたが正しいですか？」 |
| `[選択]` | 複数選択肢から選択 | 中 | 「認証方式は A/B/C どれですか？」 |
| `[提案]` | AI からの能動的な提案 | 低 | 「検索機能を追加することを提案します」 |

### セクション構成

```markdown
# {プロジェクト名/機能名} QA ドキュメント

**生成日:** {日付}
**ステータス:** 回答待ち / 回答済み / 確認完了

---

## 1. 基本情報

### Q1.1: {質問} [必須]
回答:

### Q1.2: {質問} [確認]
**AI の理解:** {推測内容}

正しいですか？: [ ] はい / [ ] いいえ
修正する場合:

---

## 2. 機能要件

### Q2.1: {質問} [必須]
回答:

### Q2.2: {質問} [選択]
以下から選択してください:
- [ ] A: {説明}
- [ ] B: {説明}
- [ ] C: {説明}

---

## 3. AI からの提案

> 以下は Input を分析した上での提案です。採用する場合はチェックを入れてください。

### P1: {提案タイトル} [提案]
**観点:** {機能追加/セキュリティ/UX等}
**提案内容:** {具体的な提案}
**理由:** {なぜこの提案をするか}

採用しますか？:
- [ ] 採用する
- [ ] 後で検討（Phase 2 等）
- [ ] 不要

コメント:

---

## 4. その他

### Q4.1: 追加で伝えたいこと [任意]
自由に記載:

---

**回答完了後、「QA 回答完了」と伝えてください。**
```

---

## 生成ロジック

### Step 1: Input 分析

```
1. Input ファイルを読み込み
2. 記入済み項目を抽出
3. 未記入・不明瞭な項目を特定
4. 推測可能な項目を AI が補完
```

### Step 2: 質問バンクから選択

**質問生成ルール:**
```
未記入項目 → [必須] 質問
推測項目 → [確認] 質問
選択が必要な項目 → [選択] 質問
```

**コンテキスト別に質問を選択:**

詳細は [質問バンク](#質問バンク) 参照。

### Step 2.5: 提案生成

> **SSOT:** [_professional-proposals.md](_professional-proposals.md) の「提案の 10 観点」および「観点別チェックリスト」を参照

**提案生成ルール:**
```
1. Input を分析し、10 観点でギャップを特定
2. 各観点で 0〜2 件の提案を生成（重要度が高いもののみ）
3. 提案には「観点」「具体的内容」「理由」を含める
4. MVP に必須でないものは「後で検討」を推奨選択肢として提示
```

**提案しない場合:**
- ユーザーが明示的に「シンプルに」と要望
- Input で十分に網羅されている
- 技術的に実現困難
- コスト対効果が明らかに低い

### Step 3: QA ドキュメント出力

```
対応するディレクトリに出力:
- project-setup: .specify/specs/overview/qa.md
- feature: .specify/specs/features/{feature-id}/qa.md

ユーザーに回答を依頼
```

---

## 質問バンク

静的テンプレートではなく、Pre-Input の内容に応じて質問を動的に選択する。

### project-setup 質問バンク

| カテゴリ | 質問 ID | 質問 | マーカー | 条件 |
|---------|---------|------|----------|------|
| 基本情報 | PS-Q01 | プロジェクトの目的は何ですか？ | [必須] | 常に |
| 基本情報 | PS-Q02 | 対象ユーザーは誰ですか？ | [必須] | 常に |
| 基本情報 | PS-Q03 | プロジェクトの成功をどう定義しますか？ | [確認] | 常に |
| 機能 | PS-Q10 | MVP に含める機能は以下で正しいですか？ | [確認] | 機能が特定された場合 |
| 機能 | PS-Q11 | 機能の優先順位を教えてください | [選択] | 機能 >= 3 の場合 |
| 機能 | PS-Q12 | 認証方式はどれですか？ | [選択] | ユーザー管理がある場合 |
| 画面 | PS-Q20 | 主要画面の構成は以下で正しいですか？ | [確認] | 画面が特定された場合 |
| 画面 | PS-Q21 | 画面遷移は以下で正しいですか？ | [確認] | 画面 >= 2 の場合 |
| データ | PS-Q30 | 管理するデータは以下で正しいですか？ | [確認] | データが特定された場合 |
| データ | PS-Q31 | データ量の規模感を教えてください | [選択] | 常に |
| 非機能 | PS-Q40 | セキュリティ要件は以下で正しいですか？ | [確認] | 常に |
| 非機能 | PS-Q41 | 特別な運用要件はありますか？ | [確認] | 常に |

### feature 質問バンク

| カテゴリ | 質問 ID | 質問 | マーカー | 条件 |
|---------|---------|------|----------|------|
| 概要 | FEAT-Q01 | この機能の目的は何ですか？ | [必須] | 常に |
| 概要 | FEAT-Q02 | 対象ユーザーは誰ですか？ | [必須] | 常に |
| 概要 | FEAT-Q03 | 解決する課題は以下で正しいですか？ | [確認] | 常に |
| ストーリー | FEAT-Q10 | 主要なユースケースは以下で正しいですか？ | [確認] | 常に |
| ストーリー | FEAT-Q11 | 考慮すべきエッジケースはありますか？ | [確認] | 常に |
| 要件 | FEAT-Q20 | 入力項目は以下で正しいですか？ | [確認] | フォームがある場合 |
| 要件 | FEAT-Q21 | 出力・表示項目は以下で正しいですか？ | [確認] | 常に |
| 要件 | FEAT-Q22 | バリデーションルールは以下で正しいですか？ | [確認] | 入力がある場合 |
| 関連 | FEAT-Q30 | 使用するデータ（M-*/API-*）は以下で正しいですか？ | [確認] | 常に |
| 関連 | FEAT-Q31 | 関連する画面は以下で正しいですか？ | [確認] | 常に |
| 非機能 | FEAT-Q40 | パフォーマンス要件はどれですか？ | [選択] | 常に |
| 非機能 | FEAT-Q41 | 権限要件はどれですか？ | [選択] | 常に |

### 動的生成の実装

```markdown
1. Input を分析し、記入済み/未記入項目を特定
2. コンテキスト（project-setup/feature）に応じた質問バンクを選択
3. 各質問の「条件」を評価し、必要な質問のみを含める
4. 未記入項目 → [必須] として質問
5. 推測可能項目 → [確認] として AI の推測を表示
6. 選択が必要 → [選択] として選択肢を提示
```

> **Note:** templates/qa/*.md は参考例として残すが、実際の生成は上記ロジックで動的に行う。

---

## 終了条件

以下を満たすと QA ドキュメント生成完了：

1. 全ての必須セクションに質問が生成されている
2. AI の推測が適切に [確認] として提示されている
3. 選択が必要な項目が [選択] として提示されている
4. 10 観点から適切な提案が [提案] として生成されている

---

## 次のステップ

QA ドキュメント生成完了 → ユーザー回答待ち → [_qa-followup.md](_qa-followup.md) でフォローアップ
