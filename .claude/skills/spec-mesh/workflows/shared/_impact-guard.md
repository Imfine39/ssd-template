# Impact Guard / Quick 判定

変更の規模を判定し、適切なワークフローへ誘導する共通コンポーネント。

---

## 使用場面

| Entry タイプ | 使用目的 |
|-------------|---------|
| **quick** | 直接実装可否を判定 |
| **fix** | 小規模修正（直接実装）か大規模修正（fix.md）かを判定 |

---

## 判定基準

以下の基準で変更の規模を評価する：

| 基準 | 小規模（直接実装） | 大規模（Spec 経由） |
|------|-------------------|-------------------|
| **影響ファイル数** | 1-3 ファイル | 4+ ファイル |
| **Spec 変更** | なし | あり |
| **テスト影響** | 既存テストで OK | 新規テスト必要 |
| **API 変更** | なし | あり |
| **DB スキーマ変更** | なし | あり |

---

## 判定ロジック

```
変更内容を分析
    │
    ↓
各基準をチェック
    │
    ├─ すべて「小規模」列に該当
    │       │
    │       └── 判定結果: 小規模
    │           → 直接 implement.md へ
    │
    └─ 1つでも「大規模」列に該当
            │
            └── 判定結果: 大規模
                    │
                    ├─ 機能追加性質
                    │       └── add タイプへ誘導
                    │           → 「add-input.md に記入して再依頼」
                    │
                    └─ バグ修正性質
                            └── fix.md へ
```

---

## 実行手順

### 1. 変更内容の分析

ユーザーの依頼から変更内容を特定：

```
AskUserQuestion:
  questions:
    - question: "変更の影響範囲を教えてください"
      header: "影響範囲"
      options:
        - label: "1-3 ファイル"
          description: "小規模な変更"
        - label: "4+ ファイル"
          description: "複数コンポーネントに影響"
      multiSelect: false
```

### 2. 各基準の評価

```markdown
=== Impact Guard 判定 ===

| 基準 | 評価 |
|------|------|
| 影響ファイル数 | {1-3 / 4+} |
| Spec 変更 | {なし / あり} |
| テスト影響 | {既存でOK / 新規必要} |
| API 変更 | {なし / あり} |
| DB スキーマ変更 | {なし / あり} |

判定結果: {小規模 / 大規模}
```

### 3. 結果に応じた誘導

**小規模の場合:**
```
変更は小規模と判定されました。
直接 implement ワークフロー で実装します。

Read tool: .claude/skills/spec-mesh/workflows/implement.md
```

**大規模（機能追加性質）の場合:**
```
変更は大規模と判定されました。
Feature Spec の作成が必要です。

.specify/input/add-input.md に詳細を記入し、
「機能を追加して」と再度依頼してください。
```

**大規模（バグ修正性質）の場合:**
```
変更は大規模と判定されました。
Fix Spec の作成が必要です。

Read tool: .claude/skills/spec-mesh/workflows/fix.md
```

---

## 判定の目安

### 小規模の例

- タイポ修正
- コメント追加
- 単一ファイルのバグ修正
- 既存コンポーネントのスタイル調整
- 設定値の変更

### 大規模の例

- 新規画面の追加
- API エンドポイントの追加/変更
- データベーススキーマの変更
- 複数コンポーネントに影響する修正
- 新規テストが必要な変更
- Spec の定義変更が必要な変更

---

## 注意事項

1. **迷った場合は大規模と判定**
   - 小規模と判定して問題が発生するより、大規模として慎重に進める方が安全

2. **ユーザーの意見を尊重**
   - 判定結果をユーザーに提示し、異論があれば再検討

3. **Spec 変更の有無が最重要**
   - Spec 定義の変更が必要な場合は、ファイル数に関わらず大規模
